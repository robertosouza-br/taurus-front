<div class="dashboard">
  <!-- Loading -->
  <app-loading-spinner *ngIf="carregando" [overlay]="true" message="Carregando dashboard..."></app-loading-spinner>

  <!-- Welcome Card -->
  <div *ngIf="mostrarWelcomeCard" class="welcome-card">
    <button 
      class="close-btn" 
      (click)="fecharWelcomeCard()"
      pTooltip="Fechar card de boas-vindas"
      tooltipPosition="left">
      <i class="pi pi-times"></i>
    </button>
    <div class="welcome-content">
      <img src="assets/images/logo_sm.png" alt="Taurus" class="dashboard-logo">
      <div class="welcome-text">
        <h1>Bem-vindo ao sistema</h1>
        <p>Gestão de imóveis</p>
        <div *ngIf="dashboard" class="user-profile-badge">
          <p-tag [value]="dashboard.perfilUsuario" severity="info"></p-tag>
        </div>
      </div>
    </div>
  </div>

  <!-- Erro State -->
  <div *ngIf="erro && !carregando" class="error-state">
    <p-card>
      <div class="text-center p-4">
        <i class="pi pi-exclamation-triangle" style="font-size: 3rem; color: var(--red-500);"></i>
        <h3 class="mt-3">Erro ao carregar dashboard</h3>
        <p class="text-muted">Não foi possível carregar os dados do dashboard.</p>
        <app-custom-button
          label="Tentar Novamente"
          icon="pi pi-refresh"
          severity="primary"
          (onClick)="recarregar()"
          styleClass="mt-3">
        </app-custom-button>
      </div>
    </p-card>
  </div>

  <!-- Notificações -->
  <div *ngIf="notificacoes.length > 0 && !carregando" class="section-container mb-4">
    <p-card styleClass="section-card">
      <ng-template pTemplate="header">
        <div class="section-header-elegant">
          <div class="header-content">
            <i class="pi pi-bell header-icon"></i>
            <h3 class="header-title">Notificações</h3>
            <span class="header-count" *ngIf="notificacoesCount > 0">{{ notificacoesCount }}</span>
          </div>
          <button 
            class="toggle-btn"
            (click)="toggleNotificacoes()"
            [class.collapsed]="!mostrarNotificacoes"
            [pTooltip]="mostrarNotificacoes ? 'Ocultar' : 'Mostrar'"
            tooltipPosition="left">
            <span class="toggle-icon"></span>
          </button>
        </div>
      </ng-template>
      
      <div *ngIf="mostrarNotificacoes" class="notifications-modern-grid">
        <div 
          *ngFor="let notificacao of notificacoes" 
          class="notification-modern-card"
          [class.priority-high]="notificacao.prioridade === 'ALTA'"
          [class.priority-medium]="notificacao.prioridade === 'MEDIA'"
          [class.priority-low]="notificacao.prioridade === 'BAIXA'"
          (click)="navegarParaNotificacao(notificacao)">
          
          <!-- Badge de contador no topo direito -->
          <div class="notification-badge-corner" *ngIf="notificacao.contador > 0">
            <span class="badge-count">{{ notificacao.contador }}</span>
          </div>

          <!-- Área principal do card -->
          <div class="notification-main">
            <!-- Ícone circular -->
            <div class="notification-icon-circle"
                 [class.icon-danger]="getSeverity(notificacao) === 'danger'"
                 [class.icon-warning]="getSeverity(notificacao) === 'warning'"
                 [class.icon-info]="getSeverity(notificacao) === 'info'">
              <i [class]="notificacao.icone"></i>
            </div>

            <!-- Conteúdo -->
            <div class="notification-body">
              <div class="notification-header-modern">
                <h4 class="notification-title-modern">{{ notificacao.titulo }}</h4>
              </div>
              
              <p class="notification-message-modern">{{ notificacao.mensagem }}</p>
              
              <div class="notification-meta">
                <span class="notification-date">
                  <i class="pi pi-clock"></i>
                  {{ notificacao.data | date: 'dd/MM/yyyy' }} às {{ notificacao.data | date: 'HH:mm' }}
                </span>
                <span class="notification-priority-badge" 
                      [class.badge-high]="notificacao.prioridade === 'ALTA'"
                      [class.badge-medium]="notificacao.prioridade === 'MEDIA'"
                      [class.badge-low]="notificacao.prioridade === 'BAIXA'">
                  {{ notificacao.prioridade }}
                </span>
              </div>
            </div>
          </div>

          <!-- Indicador de ação -->
          <div class="notification-action-hint">
            <i class="pi pi-arrow-right"></i>
          </div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Estatísticas -->
  <div *ngIf="estatisticas && !carregando" class="section-container mb-4">
    <p-card styleClass="section-card">
      <ng-template pTemplate="header">
        <div class="section-header-elegant">
          <div class="header-content">
            <i class="pi pi-chart-line header-icon"></i>
            <h3 class="header-title">Estatísticas</h3>
          </div>
          <button 
            class="toggle-btn"
            (click)="toggleEstatisticas()"
            [class.collapsed]="!mostrarEstatisticas"
            [pTooltip]="mostrarEstatisticas ? 'Ocultar' : 'Mostrar'"
            tooltipPosition="left">
            <span class="toggle-icon"></span>
          </button>
        </div>
      </ng-template>
      
      <div *ngIf="mostrarEstatisticas" class="stats-grid">
        <!-- Contatos Pendentes -->
        <div class="stat-card" *ngIf="estatisticas.contatosPendentes > 0">
          <div class="stat-icon" style="background: var(--orange-100); color: var(--orange-500);">
            <i class="pi pi-envelope"></i>
          </div>
          <div class="stat-content">
            <h3>Contatos Pendentes</h3>
            <p class="stat-value">{{ estatisticas.contatosPendentes }}</p>
          </div>
        </div>

        <!-- Contatos Não Lidos -->
        <div class="stat-card" *ngIf="estatisticas.contatosNaoLidos > 0">
          <div class="stat-icon" style="background: var(--yellow-100); color: var(--yellow-600);">
            <i class="pi pi-inbox"></i>
          </div>
          <div class="stat-content">
            <h3>Contatos Não Lidos</h3>
            <p class="stat-value">{{ estatisticas.contatosNaoLidos }}</p>
          </div>
        </div>

        <!-- Usuários Ativos -->
        <div class="stat-card">
          <div class="stat-icon" style="background: var(--blue-100); color: var(--blue-500);">
            <i class="pi pi-users"></i>
          </div>
          <div class="stat-content">
            <h3>Usuários Ativos</h3>
            <p class="stat-value">{{ estatisticas.usuariosAtivos }}</p>
          </div>
        </div>

        <!-- Corretores Cadastrados -->
        <div class="stat-card">
          <div class="stat-icon" style="background: var(--green-100); color: var(--green-500);">
            <i class="pi pi-briefcase"></i>
          </div>
          <div class="stat-content">
            <h3>Corretores</h3>
            <p class="stat-value">{{ estatisticas.corretoresCadastrados }}</p>
          </div>
        </div>

        <!-- Empreendimentos Disponíveis -->
        <div class="stat-card">
          <div class="stat-icon" style="background: var(--purple-100); color: var(--purple-500);">
            <i class="pi pi-building"></i>
          </div>
          <div class="stat-content">
            <h3>Empreendimentos</h3>
            <p class="stat-value">{{ estatisticas.empreendimentosDisponiveis }}</p>
          </div>
        </div>

        <!-- Acessos Hoje -->
        <div class="stat-card">
          <div class="stat-icon" style="background: var(--cyan-100); color: var(--cyan-500);">
            <i class="pi pi-chart-line"></i>
          </div>
          <div class="stat-content">
            <h3>Acessos Hoje</h3>
            <p class="stat-value">{{ estatisticas.acessosHoje }}</p>
          </div>
        </div>
      </div>
    </p-card>
  </div>

  <!-- Informações do Sistema -->
  <div class="section-container mt-4">
    <p-card styleClass="section-card">
      <ng-template pTemplate="header">
        <div class="section-header-elegant">
          <div class="header-content">
            <i class="pi pi-info-circle header-icon"></i>
            <h3 class="header-title">Sobre o Sistema</h3>
          </div>
          <button 
            class="toggle-btn"
            (click)="toggleInfo()"
            [class.collapsed]="!mostrarInfo"
            [pTooltip]="mostrarInfo ? 'Ocultar' : 'Mostrar'"
            tooltipPosition="left">
            <span class="toggle-icon"></span>
          </button>
        </div>
      </ng-template>
      
      <div *ngIf="mostrarInfo" class="info-content">
        <p class="info-description">Sistema moderno de gestão de imóveis com arquitetura full-stack robusta.</p>
        
        <div class="features-grid">
          <div class="feature-item">
            <i class="pi pi-lock"></i>
            <span>Autenticação JWT</span>
          </div>
          <div class="feature-item">
            <i class="pi pi-shield"></i>
            <span>Controle de Permissões</span>
          </div>
          <div class="feature-item">
            <i class="pi pi-bell"></i>
            <span>Notificações Real-time</span>
          </div>
          <div class="feature-item">
            <i class="pi pi-eye"></i>
            <span>Guards de Rotas</span>
          </div>
          <div class="feature-item">
            <i class="pi pi-share-alt"></i>
            <span>HTTP Interceptors</span>
          </div>
          <div class="feature-item">
            <i class="pi pi-mobile"></i>
            <span>Layout Responsivo</span>
          </div>
          <div class="feature-item">
            <i class="pi pi-bars"></i>
            <span>Menu Expansível</span>
          </div>
          <div class="feature-item">
            <i class="pi pi-building"></i>
            <span>Gestão de Empreendimentos</span>
          </div>
          <div class="feature-item">
            <i class="pi pi-envelope"></i>
            <span>Sistema de Contatos</span>
          </div>
        </div>
      </div>
    </p-card>
  </div>
</div>
