<div class="form-container">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <!-- Page Header -->
  <app-page-header
    title="Mensagens de Contato"
    subtitle="Gerencie as mensagens recebidas através do formulário de contato"
    icon="pi pi-envelope">
  </app-page-header>

  <!-- Filtro -->
  <div class="flex align-items-center justify-content-end mb-3">
    <div style="width: 300px;">
      <app-autocomplete
        id="statusFiltro"
        label="Filtrar por Status"
        [(ngModel)]="statusFiltro"
        [suggestions]="statusOptions"
        field="label"
        (onSelect)="filtrarPorStatus()"
        (completeMethod)="buscarStatus($event)"
        placeholder="Todos">
      </app-autocomplete>
    </div>
  </div>

  <!-- Tabela -->
  <app-data-table
    [data]="contatos"
    [loading]="carregando"
    [totalRecords]="totalRegistros"
    [columns]="colunas"
    [actions]="acoes"
    [lazy]="true"
    [rows]="rows"
    [striped]="false"
    (onLazyLoad)="onLazyLoad($event)"
    [emptyMessage]="'Nenhuma mensagem encontrada'">
    
    <!-- Template para Data -->
    <ng-template appTableTemplate="data" let-contato="rowData">
      <div [style.padding]="'0.5rem'"
           class="flex flex-column gap-1 align-items-center justify-content-center">
        <div class="font-medium" 
             [style.color]="contato.status === 'PENDENTE' ? '#d97706' : '#495057'"
             [style.font-weight]="'600'">
          {{ formatarDataComRelativo(contato.dataCriacao).relativa }}
        </div>
        <div class="text-xs" [style.color]="'#6c757d'">
          {{ formatarDataComRelativo(contato.dataCriacao).completa }}
        </div>
      </div>
    </ng-template>

    <!-- Template para Status -->
    <ng-template appTableTemplate="status" let-contato="rowData">
      <div [style.padding]="'0.5rem'"
           [style.border-left]="contato.status === 'PENDENTE' ? '4px solid #f59e0b' : 'none'"
           class="flex flex-column gap-2 align-items-center justify-content-center status-cell-marker">
        <div class="flex align-items-center gap-2">
          <i [class]="getStatusIcon(contato.status)" 
             [style.font-size]="'1.1rem'"
             [style.color]="contato.status === 'PENDENTE' ? '#f59e0b' : contato.status === 'RESPONDIDO' ? '#10b981' : '#3b82f6'"></i>
          <p-tag 
            [value]="getStatusLabel(contato.status)"
            [severity]="getStatusSeverity(contato.status)"
            [style.font-size]="'0.35rem'"
            [style.padding]="'0.1rem 0.2rem'"
            [style.font-weight]="'500'">
          </p-tag>
        </div>
        
        <!-- Informações adicionais baseadas no status -->
        <div *ngIf="contato.usuarioLeitura && contato.status !== 'PENDENTE'"
             [style.font-size]="'0.7rem'"
             [style.color]="'#6c757d'">
          <i class="pi pi-user" [style.font-size]="'0.65rem'"></i> 
          {{ contato.usuarioLeitura.split('@')[0] }}
        </div>
      </div>
    </ng-template>

    <!-- Template para Nome -->
    <ng-template appTableTemplate="nome" let-contato="rowData">
      <div [style.padding]="'0.5rem'"
           class="flex flex-column gap-1 align-items-center justify-content-center">
        <div [style.font-weight]="'600'">{{ contato.nome }}</div>
        <div [style.font-size]="'0.875rem'" 
             [style.color]="'#6c757d'"
             class="flex align-items-center gap-1">
          <i class="pi pi-envelope" [style.font-size]="'0.75rem'"></i>
          {{ contato.email }}
        </div>
        <div *ngIf="contato.telefone"
             [style.font-size]="'0.875rem'" 
             [style.color]="'#6c757d'"
             class="flex align-items-center gap-1">
          <i class="pi pi-phone" [style.font-size]="'0.75rem'"></i>
          {{ contato.telefone }}
        </div>
      </div>
    </ng-template>

    <!-- Template para Assunto -->
    <ng-template appTableTemplate="assunto" let-contato="rowData">
      <div [style.padding]="'0.5rem'"
           class="flex flex-column gap-1">
        <div [style.font-weight]="'600'">{{ contato.assunto }}</div>
        <div [style.font-size]="'0.875rem'" [style.color]="'#6c757d'">
          {{ truncarTexto(contato.mensagem, 80) }}
        </div>
      </div>
    </ng-template>
  </app-data-table>
</div>
