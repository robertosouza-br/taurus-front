<div class="perfis-lista-container">
  <div class="header">
    <h2><i class="pi pi-shield"></i> Perfis de Acesso</h2>
    <button 
      *ngIf="podeIncluir"
      pButton 
      label="Novo Perfil" 
      icon="pi pi-plus"
      (click)="novoPerfil()">
    </button>
  </div>

  <p-table 
    [value]="perfis" 
    [loading]="carregando"
    [paginator]="true"
    [rows]="10"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} perfis"
    [rowsPerPageOptions]="[10, 25, 50]"
    styleClass="p-datatable-gridlines">
    
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 3rem">#</th>
        <th>Nome</th>
        <th>Descrição</th>
        <th style="width: 10rem">Status</th>
        <th style="width: 12rem">Funcionalidades</th>
        <th style="width: 12rem">Permissões</th>
        <th style="width: 12rem">Ações</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-perfil let-i="rowIndex">
      <tr>
        <td>{{ i + 1 }}</td>
        <td><strong>{{ perfil.nome }}</strong></td>
        <td>{{ perfil.descricao || '-' }}</td>
        <td>
          <p-tag 
            [value]="perfil.ativo ? 'Ativo' : 'Inativo'" 
            [severity]="perfil.ativo ? 'success' : 'danger'">
          </p-tag>
        </td>
        <td class="text-center">
          <p-tag 
            [value]="getTotalFuncionalidades(perfil) + ' funcionalidade(s)'" 
            severity="info">
          </p-tag>
        </td>
        <td class="text-center">
          <p-tag 
            [value]="getTotalPermissoes(perfil) + ' permissão(ões)'" 
            severity="warning">
          </p-tag>
        </td>
        <td>
          <div class="acoes">
            <button 
              *ngIf="podeAlterar"
              pButton 
              icon="pi pi-cog" 
              class="p-button-text p-button-info"
              pTooltip="Configurar Permissões"
              (click)="editarPerfil(perfil)">
            </button>
            <button 
              *ngIf="podeExcluir"
              pButton 
              icon="pi pi-trash" 
              class="p-button-text p-button-danger"
              pTooltip="Excluir"
              (click)="excluirPerfil(perfil)">
            </button>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" class="text-center">
          <div class="empty-message">
            <i class="pi pi-info-circle"></i>
            <p>Nenhum perfil cadastrado</p>
            <button 
              *ngIf="podeIncluir"
              pButton 
              label="Criar Primeiro Perfil" 
              icon="pi pi-plus"
              class="p-button-sm"
              (click)="novoPerfil()">
            </button>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-confirmDialog></p-confirmDialog>
