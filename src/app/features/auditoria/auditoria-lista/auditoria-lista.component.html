<div class="lista-container">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <!-- Page Header -->
  <app-page-header
    title="Auditoria"
    subtitle="Consulte o histórico de alterações do sistema"
    icon="pi pi-history">
  </app-page-header>

  <!-- Filtros -->
  <p-card header="Filtros" styleClass="mb-3">
    <br>
    <div class="formgrid grid">
      <div class="field col-12 md:col-3">
        <app-autocomplete
          id="tipoEntidade"
          label="Tipo de Entidade"
          [(ngModel)]="entidadeSelecionada"
          [suggestions]="entidadesFiltradas"
          field="label"
          placeholder="Todas"
          (completeMethod)="filtrarEntidades($event)"
          (onDropdownClick)="mostrarTodasEntidades()">
        </app-autocomplete>
      </div>

      <div class="field col-12 md:col-3">
        <app-input-text
          id="nomeUsuario"
          label="Nome/Email do Usuário"
          [(ngModel)]="filtro.nomeUsuario"
          placeholder="Nome ou email">
        </app-input-text>
      </div>

      <div class="p-field col-12 md:col-3">
        <app-input-date
          id="dataInicio"
          label="Data Início"
          [(ngModel)]="filtro.dataInicio"
          placeholder="dd/mm/aaaa">
        </app-input-date>
      </div>

      <div class="p-field col-12 md:col-3">
        <app-input-date
          id="dataFim"
          label="Data Fim"
          [(ngModel)]="filtro.dataFim"
          placeholder="dd/mm/aaaa">
        </app-input-date>
      </div>

      <div class="field col-12 md:col-3">
        <app-input-cpf
          id="cpfUsuario"
          label="CPF do Usuário"
          [(ngModel)]="filtro.cpfUsuario"
          placeholder="000.000.000-00">
        </app-input-cpf>
      </div>
    </div>

    <div class="formgrid grid">
      <div class="field col-12 flex align-items-center justify-content-center gap-2">
        <app-custom-button
          label="Limpar"
          icon="pi pi-refresh"
          severity="secondary"
          [outlined]="true"
          actionType="clear"
          (onClick)="limparFiltros()">
        </app-custom-button>
        <app-custom-button
          label="Filtrar"
          icon="pi pi-search"
          actionType="none"
          (onClick)="filtrar()">
        </app-custom-button>
      </div>
    </div>
  </p-card>

    <!-- Tabela -->
    <app-data-table
      [data]="auditorias"
      [columns]="colunas"
      [actions]="acoes"
      [totalRecords]="totalRegistros"
      [loading]="carregando"
      [lazy]="true"
      [rows]="10"
      (onLazyLoad)="onLazyLoad($event)">
      
      <!-- Template para tipo de operação -->
      <ng-template appTableTemplate="tipoOperacao" let-auditoria="rowData">
        <p-tag
          [value]="getLabelOperacao(auditoria.tipoOperacao)"
          [severity]="getSeverityOperacao(auditoria.tipoOperacao)">
        </p-tag>
      </ng-template>

      <!-- Template para CPF -->
      <ng-template appTableTemplate="usuarioCpf" let-auditoria="rowData">
        {{ formatarCpf(auditoria.usuarioCpf) }}
      </ng-template>

      <!-- Template para data/hora -->
      <ng-template appTableTemplate="dataHora" let-auditoria="rowData">
        {{ formatarDataHora(auditoria.dataHora) }}
      </ng-template>
  </app-data-table>
</div>