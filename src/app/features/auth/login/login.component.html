<div class="login-container">
  <div class="login-card">
    <!-- Logo e Título -->
    <div class="login-header">
      <img src="assets/images/logo_sm.png" alt="Taurus" class="logo">
      <p class="subtitle">Sistema de Vendas e Reservas de imóveis</p>
    </div>

    <!-- Formulário de Login -->
    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">
      
      <!-- Mensagem de Erro -->
      <div class="error-message" *ngIf="errorMessage">
        <div class="error-alert" [ngClass]="{
          'alert-warning': tipoErro === 'credenciais',
          'alert-danger': tipoErro === 'bloqueado',
          'alert-info': tipoErro === 'generico',
          'alert-inatividade': tipoErro === 'inatividade'
        }">
          <i class="pi" [ngClass]="{
            'pi-exclamation-triangle': tipoErro === 'credenciais',
            'pi-lock': tipoErro === 'bloqueado',
            'pi-info-circle': tipoErro === 'generico',
            'pi-clock': tipoErro === 'inatividade'
          }"></i>
          <div class="error-content">
            <strong>
              <span *ngIf="tipoErro === 'credenciais'">Atenção!</span>
              <span *ngIf="tipoErro === 'bloqueado'">Acesso Bloqueado</span>
              <span *ngIf="tipoErro === 'generico'">Erro</span>
              <span *ngIf="tipoErro === 'inatividade'">Sessão Encerrada</span>
            </strong>
            <p>{{ errorMessage }}</p>
          </div>
        </div>
      </div>

      <!-- Campo CPF -->
      <div class="form-field">
        <span class="p-float-label">
          <input 
            id="cpf" 
            type="text" 
            pInputText 
            formControlName="cpf"
            [class.ng-invalid]="submitted && f['cpf'].errors"
            class="w-full"
            autocomplete="username"
            maxlength="14"
            (input)="onCpfInput($event)"
          >
          <label for="cpf">CPF</label>
        </span>
        <small class="p-error" *ngIf="submitted && f['cpf'].errors?.['required']">
          CPF é obrigatório
        </small>
        <small class="p-error" *ngIf="submitted && f['cpf'].errors?.['minlengthCpf']">
          CPF deve ter 11 dígitos
        </small>
        <div class="field-helper" *ngIf="!submitted || (!f['cpf'].errors?.['required'] && !f['cpf'].errors?.['minlengthCpf'])" style="visibility: hidden;">
          <i class="pi pi-info-circle"></i>
          <span>&nbsp;</span>
        </div>
      </div>

      <!-- Campo Senha -->
      <div class="form-field">
        <span class="p-float-label">
          <p-password 
            id="senha"
            formControlName="senha"
            [toggleMask]="true"
            [feedback]="false"
            [class.ng-invalid]="submitted && f['senha'].errors"
            inputId="senha"
            autocomplete="new-password"
          ></p-password>
          <label for="senha">Senha</label>
        </span>
        <small class="p-error" *ngIf="submitted && f['senha'].errors?.['required']">
          Senha é obrigatória
        </small>
        <small class="p-error" *ngIf="submitted && f['senha'].errors?.['minlength']">
          Senha deve ter no mínimo 6 caracteres
        </small>
      </div>

      <!-- Botão de Login -->
      <div class="form-actions">
        <p-button 
          type="submit"
          label="Entrar" 
          icon="pi pi-sign-in"
          [loading]="loading"
          [disabled]="loading || loginForm.disabled"
          styleClass="w-full"
        ></p-button>
      </div>

      <!-- Botão Suporte (aparece quando bloqueado) -->
      <div class="form-actions" *ngIf="mostrarBotaoSuporte">
        <p-button 
          type="button"
          label="Falar com Suporte" 
          icon="pi pi-phone"
          severity="secondary"
          [outlined]="true"
          styleClass="w-full"
          (onClick)="falarComSuporte()"
        ></p-button>
      </div>

      <!-- Links adicionais -->
      <div class="form-footer">
        <a routerLink="/auth/recuperar-senha" class="forgot-password">Esqueceu sua senha?</a>
        <a *ngIf="loginForm.disabled" (click)="limparErros()" class="try-again">Tentar novamente</a>
      </div>
    </form>

    <!-- Link para cadastro de corretor -->
    <div class="cadastro-corretor-section">
      <div class="divider">
        <span>ou</span>
      </div>
      <div class="cadastro-corretor-info">
        <i class="pi pi-briefcase"></i>
        <div class="text-content">
          <p class="title">Você é corretor?</p>
          <a routerLink="/auth/cadastro-corretor" class="link-cadastro">
            Cadastre-se e faça parte da nossa equipe
            <i class="pi pi-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="login-footer">
    <a routerLink="/contato-publico" class="contact-link">
      <i class="pi pi-envelope"></i> Fale Conosco
    </a>
    <p>&copy; 2026 CALTER Construtora - Todos os direitos reservados</p>
  </div>
</div>
