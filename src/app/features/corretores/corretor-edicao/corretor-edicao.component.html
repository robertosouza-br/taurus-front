<div class="corretor-edicao-container">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <!-- Page Header -->
  <app-page-header
    title="Editar Corretor"
    [subtitle]="corretor ? corretor.nome : 'Carregando...'"
    icon="pi pi-briefcase">
  </app-page-header>

  <!-- Loading -->
  <app-loading-spinner *ngIf="carregando" [overlay]="true" message="Carregando dados do corretor..."></app-loading-spinner>

  <!-- Formulário -->
  <div *ngIf="!carregando && corretor" class="card">
    <form [formGroup]="formulario" (ngSubmit)="onSubmit()">
      
      <!-- Dados Pessoais -->
      <div class="form-section">
        <h3><i class="pi pi-user"></i> Dados Pessoais</h3>
        
        <div class="formgrid grid">
          <!-- Nome -->
          <div class="field col-12 md:col-6">
            <span class="p-float-label">
              <input 
                id="nome" 
                type="text" 
                pInputText 
                formControlName="nome"
                [class.ng-invalid]="submitted && f['nome'].errors"
              >
              <label for="nome">Nome Completo *</label>
            </span>
            <small class="p-error" *ngIf="submitted && f['nome'].errors?.['required']">
              Nome é obrigatório
            </small>
          </div>

          <!-- CPF (Desabilitado) -->
          <div class="field col-12 md:col-6">
            <span class="p-float-label">
              <input 
                id="cpf" 
                type="text" 
                pInputText 
                formControlName="cpf"
                [value]="formatarCpfDisplay(f['cpf'].value)"
                [disabled]="true"
              >
              <label for="cpf">CPF *</label>
            </span>
            <small class="field-help">CPF não pode ser alterado</small>
          </div>

          <!-- Email -->
          <div class="field col-12 md:col-6">
            <span class="p-float-label">
              <input 
                id="email" 
                type="email" 
                pInputText 
                formControlName="email"
                [class.ng-invalid]="submitted && f['email'].errors"
              >
              <label for="email">E-mail *</label>
            </span>
            <small class="p-error" *ngIf="submitted && f['email'].errors?.['required']">
              E-mail é obrigatório
            </small>
            <small class="p-error" *ngIf="submitted && f['email'].errors?.['email']">
              E-mail inválido
            </small>
          </div>

          <!-- Telefone -->
          <div class="field col-12 md:col-6">
            <span class="p-float-label">
              <input 
                id="telefone" 
                type="text" 
                pInputText 
                formControlName="telefone"
                [class.ng-invalid]="submitted && f['telefone'].errors"
                maxlength="11"
                (input)="onTelefoneInput($event)"
                [value]="formatarTelefoneDisplay(f['telefone'].value)"
              >
              <label for="telefone">Telefone *</label>
            </span>
            <small class="p-error" *ngIf="submitted && f['telefone'].errors?.['required']">
              Telefone é obrigatório
            </small>
          </div>

          <!-- Cargo -->
          <div class="field col-12 md:col-6">
            <span class="p-float-label">
              <p-dropdown 
                id="cargo"
                formControlName="cargo"
                [options]="cargosOptions"
                optionLabel="label"
                optionValue="value"
                [class.ng-invalid]="submitted && f['cargo'].errors"
              ></p-dropdown>
              <label for="cargo">Cargo *</label>
            </span>
          </div>

          <!-- Ativo -->
          <div class="field col-12 md:col-6">
            <div class="flex align-items-center">
              <p-checkbox 
                inputId="ativo" 
                formControlName="ativo" 
                [binary]="true"
              ></p-checkbox>
              <label for="ativo">Corretor Ativo</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Dados Bancários -->
      <div class="form-section">
        <h3><i class="pi pi-building"></i> Dados Bancários</h3>
        
        <div class="formgrid grid">
          <!-- Número do Banco -->
          <div class="field col-12 md:col-4">
            <span class="p-float-label">
              <input 
                id="numeroBanco" 
                type="text" 
                pInputText 
                formControlName="numeroBanco"
                maxlength="3"
                placeholder="Ex: 001, 237, 341"
              >
              <label for="numeroBanco">Número do Banco</label>
            </span>
            <small class="p-text-secondary">Digite o código do banco (ex: 001, 237, 341)</small>
          </div>

          <!-- Agência -->
          <div class="field col-12 md:col-4">
            <span class="p-float-label">
              <input 
                id="numeroAgencia" 
                type="text" 
                pInputText 
                formControlName="numeroAgencia"
              >
              <label for="numeroAgencia">Agência</label>
            </span>
          </div>

          <!-- Conta Corrente -->
          <div class="field col-12 md:col-4">
            <span class="p-float-label">
              <input 
                id="numeroContaCorrente" 
                type="text" 
                pInputText 
                formControlName="numeroContaCorrente"
              >
              <label for="numeroContaCorrente">Conta Corrente</label>
            </span>
          </div>

          <!-- Tipo de Conta -->
          <div class="field col-12">
            <span class="p-float-label">
              <input 
                id="tipoConta" 
                type="text" 
                pInputText 
                formControlName="tipoConta"
                placeholder="Ex: CORRENTE, POUPANÇA"
              >
              <label for="tipoConta">Tipo de Conta</label>
            </span>
          </div>
        </div>
      </div>

      <!-- Dados PIX -->
      <div class="form-section">
        <h3><i class="pi pi-qrcode"></i> Dados PIX</h3>
        
        <div class="formgrid grid">
          <!-- Tipo de Chave PIX -->
          <div class="field col-12 md:col-6">
            <span class="p-float-label">
              <p-dropdown 
                id="tipoChavePix"
                formControlName="tipoChavePix"
                [options]="tiposChavePixOptions"
                optionLabel="label"
                optionValue="value"
                [class.ng-invalid]="submitted && f['tipoChavePix'].errors"
              ></p-dropdown>
              <label for="tipoChavePix">Tipo de Chave PIX *</label>
            </span>
          </div>

          <!-- Chave PIX -->
          <div class="field col-12 md:col-6">
            <span class="p-float-label">
              <input 
                id="chavePix" 
                type="text" 
                pInputText 
                formControlName="chavePix"
                [class.ng-invalid]="submitted && f['chavePix'].errors"
              >
              <label for="chavePix">Chave PIX *</label>
            </span>
            <small class="p-error" *ngIf="submitted && f['chavePix'].errors?.['required']">
              Chave PIX é obrigatória
            </small>
          </div>
        </div>
      </div>

      <!-- Informações do Sistema -->
      <div class="info-section" *ngIf="corretor?.id">
        <i class="pi pi-info-circle"></i>
        <div class="info-content">
          <strong>ID Sistema RMS:</strong> {{ corretor.id }}
        </div>
      </div>

      <!-- Botões de Ação -->
      <div class="form-actions">
        <p-button 
          type="button"
          label="Cancelar" 
          icon="pi pi-times"
          severity="secondary"
          [outlined]="true"
          [disabled]="salvando"
          (onClick)="cancelar()"
        ></p-button>
        
        <p-button 
          type="submit"
          label="Salvar Alterações" 
          icon="pi pi-check"
          [loading]="salvando"
          [disabled]="salvando"
        ></p-button>
      </div>
    </form>
  </div>
</div>
