<div class="form-container">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <!-- Page Header -->
  <app-page-header
    title="Editar Corretor"
    [subtitle]="corretor ? corretor.nome : 'Carregando...'"
    icon="pi pi-briefcase">
  </app-page-header>

  <!-- Mensagem de Status do Usuário -->
  <div *ngIf="exibirMensagemUsuario && !existeUsuarioLocal" 
       class="alert-warning" 
       style="background-color: #fff3cd; border: 1px solid #ffc107; border-radius: 6px; padding: 1rem; margin-bottom: 1.5rem; display: flex; align-items: start; gap: 1rem;">
    <i class="pi pi-exclamation-triangle" style="color: #856404; font-size: 1.5rem; margin-top: 0.2rem;"></i>
    <div style="flex: 1;">
      <div style="font-weight: 600; color: #856404; margin-bottom: 0.5rem; font-size: 1rem;">
        Atenção: Corretor sem Usuário no Sistema
      </div>
      <p style="margin: 0; color: #856404; line-height: 1.5;">
        Este corretor não possui usuário no sistema TAURUS. 
        Ao salvar as alterações, um usuário será criado automaticamente para acesso ao sistema.
      </p>
    </div>
  </div>

  <div *ngIf="exibirMensagemUsuario && existeUsuarioLocal" 
       class="alert-info" 
       style="background-color: #d1ecf1; border: 1px solid #17a2b8; border-radius: 6px; padding: 1rem; margin-bottom: 1.5rem; display: flex; align-items: start; gap: 1rem;">
    <i class="pi pi-check-circle" style="color: #0c5460; font-size: 1.5rem; margin-top: 0.2rem;"></i>
    <div style="flex: 1;">
      <div style="font-weight: 600; color: #0c5460; margin-bottom: 0.5rem; font-size: 1rem;">
        Corretor com Usuário no Sistema
      </div>
      <p style="margin: 0; color: #0c5460; line-height: 1.5;">
        Este corretor possui usuário cadastrado no sistema interno.
      </p>
    </div>
  </div>

  <!-- Loading Carregamento -->
  <app-loading-spinner *ngIf="carregando" [overlay]="true" message="Carregando dados do corretor..."></app-loading-spinner>

  <!-- Loading Salvamento -->
  <app-loading-spinner *ngIf="salvando" [overlay]="true" message="Salvando alterações..."></app-loading-spinner>

  <!-- Formulário -->
  <div *ngIf="!carregando && corretor" class="corretor-form">
    <!-- Dados Pessoais -->
    <p-card class="corretor-card">
      <ng-template pTemplate="header">
        <div class="card-gradient-header">
          <i class="pi pi-user"></i>
          <span>Dados Pessoais</span>
        </div>
      </ng-template>

      <div class="p-fluid">
        <br>
        <div class="p-field">
          <app-input-text
            id="nome"
            label="Nome Completo"
            [(ngModel)]="nome"
            [required]="true"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-cpf
            id="cpf"
            label="CPF"
            [(ngModel)]="cpf"
            [required]="true"
            [disabled]="true"
            [showValidation]="tentouSalvar">
          </app-input-cpf>
          <small class="field-help" style="color: #64748b; display: block; margin-top: 0.25rem;">
            <i class="pi pi-info-circle"></i> CPF não pode ser alterado
          </small>
        </div>

        <div class="p-field">
          <app-input-emails
            id="email"
            label="E-mail(s)"
            [(ngModel)]="emails"
            [required]="true"
            [maxLength]="60"
            [showValidation]="tentouSalvar">
          </app-input-emails>
        </div>

        <div class="p-field">
          <app-input-text
            id="nomeGuerra"
            label="Nome de Guerra"
            [(ngModel)]="nomeGuerra"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-telefone
            id="telefone"
            label="Telefone"
            [(ngModel)]="telefone"
            [required]="false"
            [showValidation]="tentouSalvar"
            placeholder="(00) 00000-0000">
          </app-input-telefone>
        </div>

        <div class="p-field">
          <app-input-text
            id="numeroCreci"
            label="Número do CRECI"
            [(ngModel)]="numeroCreci"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-autocomplete
            id="cargo"
            label="Cargo"
            [(ngModel)]="cargoSelecionado"
            [suggestions]="cargosFiltrados"
            (completeMethod)="filtrarCargos($event)"
            (onDropdownClick)="mostrarTodosCargos()"
            field="label"
            [required]="true"
            [disabled]="true"
            [showValidation]="tentouSalvar"
            emptyMessage="Nenhum cargo encontrado"
            placeholder="Digite para buscar um cargo">
          </app-autocomplete>
        </div>
        <br>
      </div>
    </p-card>

    <!-- Dados Bancários -->
    <p-card class="corretor-card">
      <ng-template pTemplate="header">
        <div class="card-gradient-header">
          <i class="pi pi-credit-card"></i>
          <span>Dados Bancários (Opcional)</span>
        </div>
      </ng-template>

      <div class="p-fluid">
        <br>
        <div class="p-field">
          <app-autocomplete
            id="numeroBanco"
            label="Banco"
            [(ngModel)]="bancoSelecionado"
            [suggestions]="bancosFiltrados"
            (completeMethod)="filtrarBancos($event)"
            (onDropdownClick)="mostrarTodosBancos()"
            field="label"
            [required]="false"
            [showValidation]="tentouSalvar"
            emptyMessage="Nenhum banco encontrado"
            placeholder="Digite o código ou nome do banco">
          </app-autocomplete>
        </div>

        <div class="p-field">
          <app-input-text
            id="numeroAgencia"
            label="Agência"
            [(ngModel)]="numeroAgencia"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-text
            id="numeroContaCorrente"
            label="Conta Corrente"
            [(ngModel)]="numeroContaCorrente"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-text
            id="tipoConta"
            label="Tipo de Conta"
            [(ngModel)]="tipoConta"
            [required]="false"
            [showValidation]="tentouSalvar"
            placeholder="Ex: CORRENTE, POUPANÇA">
          </app-input-text>
        </div>
        <br>
      </div>
    </p-card>

    <!-- Dados PIX -->
    <p-card class="corretor-card">
      <ng-template pTemplate="header">
        <div class="card-gradient-header">
          <i class="pi pi-qrcode"></i>
          <span>Dados PIX (Opcional)</span>
        </div>
      </ng-template>

      <div class="p-fluid">
        <br>
        <div class="p-field">
          <app-autocomplete
            id="tipoChavePix"
            label="Tipo de Chave PIX"
            [(ngModel)]="tipoChavePixSelecionado"
            [suggestions]="tiposChavePixFiltrados"
            (completeMethod)="filtrarTiposChavePix($event)"
            (onDropdownClick)="mostrarTodosTiposChavePix()"
            field="label"
            [required]="false"
            [showValidation]="tentouSalvar"
            emptyMessage="Nenhum tipo de chave encontrado"
            placeholder="Digite para buscar um tipo de chave">
          </app-autocomplete>
        </div>

        <div class="p-field">
          <app-input-text
            id="chavePix"
            label="Chave PIX"
            [(ngModel)]="chavePix"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>
        <br>
      </div>
    </p-card>

    <!-- Informações do Sistema -->
    <p-card *ngIf="corretor.id" class="corretor-card info-card">
      <ng-template pTemplate="header">
        <div class="card-gradient-header">
          <i class="pi pi-info-circle"></i>
          <span>Informações do Sistema</span>
        </div>
      </ng-template>

      <div style="display: flex; align-items: center; gap: 0.75rem;">
        <i class="pi pi-info-circle" style="color: #3b82f6; font-size: 1.5rem;"></i>
        <div>
          <div style="font-size: 0.875rem; color: #64748b; margin-bottom: 0.25rem;">Sistema RMS</div>
          <div style="font-size: 1rem; font-weight: 600; color: #1e293b;">ID: {{ corretor.id }}</div>
        </div>
      </div>
    </p-card>

    <!-- Ações -->
    <div class="form-actions">
      <app-custom-button
        label="Cancelar"
        icon="pi pi-times"
        severity="warning"
        actionType="cancel"
        [requireConfirmation]="formularioAlterado"
        (onClick)="cancelar()"
        [disabled]="salvando">
      </app-custom-button>
      <app-custom-button
        label="Limpar"
        icon="pi pi-refresh"
        severity="info"
        actionType="clear"
        [outlined]="true"
        (onClick)="limparTela()"
        [disabled]="salvando">
      </app-custom-button>
      <app-custom-button
        label="Salvar Alterações"
        icon="pi pi-save"
        severity="success"
        actionType="none"
        (onClick)="validarESalvar()"
        [loading]="salvando">
      </app-custom-button>
    </div>
  </div>
</div>
