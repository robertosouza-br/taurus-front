<div class="form-container">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <!-- Page Header -->
  <app-page-header
    title="Novo Corretor"
    subtitle="Cadastre um novo corretor no sistema"
    icon="pi pi-briefcase">
  </app-page-header>

  <div class="corretor-form">
    <!-- Dados Pessoais -->
    <p-card header="Dados Pessoais">
      <div class="p-fluid">
        <br>
        <div class="p-field">
          <app-input-text
            id="nome"
            label="Nome Completo"
            [(ngModel)]="nome"
            [required]="true"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-cpf
            id="cpf"
            label="CPF"
            [(ngModel)]="cpf"
            (ngModelChange)="onCpfChange()"
            [required]="true"
            [showValidation]="tentouSalvar">
          </app-input-cpf>
          
          <!-- Loading da validação -->
          <div *ngIf="validandoCpf" class="cpf-validacao-loading">
            <i class="pi pi-spin pi-spinner"></i>
            <span>Validando CPF...</span>
          </div>
          
          <!-- Mensagem de validação -->
          <div *ngIf="mensagemValidacaoCpf && !validandoCpf" 
               class="cpf-validacao-mensagem"
               [ngClass]="{
                 'mensagem-invalido': cpfInvalido,
                 'mensagem-erro': cpfJaCadastrado && !cpfInvalido,
                 'mensagem-sucesso': !cpfJaCadastrado && !cpfInvalido
               }">
            <i [class]="cpfInvalido ? 'pi pi-times-circle' : (cpfJaCadastrado ? 'pi pi-exclamation-triangle' : 'pi pi-check-circle')"></i>
            <span>{{ mensagemValidacaoCpf }}</span>
          </div>
        </div>

        <div class="p-field">
          <app-input-text
            id="email"
            label="E-mail"
            [(ngModel)]="email"
            [required]="true"
            [showValidation]="tentouSalvar"
            type="email">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-text
            id="nomeGuerra"
            label="Nome de Guerra"
            [(ngModel)]="nomeGuerra"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-telefone
            id="telefone"
            label="Telefone"
            [(ngModel)]="telefone"
            [required]="false"
            [showValidation]="tentouSalvar"
            placeholder="(00) 00000-0000">
          </app-input-telefone>
        </div>

        <div class="p-field">
          <app-input-text
            id="numeroCreci"
            label="Número do CRECI"
            [(ngModel)]="numeroCreci"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-autocomplete
            id="cargo"
            label="Cargo"
            [(ngModel)]="cargoSelecionado"
            [suggestions]="cargosFiltrados"
            (completeMethod)="filtrarCargos($event)"
            (onDropdownClick)="mostrarTodosCargos()"
            field="label"
            [required]="true"
            [showValidation]="tentouSalvar"
            emptyMessage="Nenhum cargo encontrado"
            placeholder="Digite para buscar um cargo">
          </app-autocomplete>
        </div>

        <div class="p-field-checkbox">
          <p-checkbox
            [(ngModel)]="ativo"
            [binary]="true"
            inputId="ativo"
            label="Corretor Ativo">
          </p-checkbox>
        </div>
        <br>
      </div>
    </p-card>

    <!-- Dados Bancários -->
    <p-card header="Dados Bancários (Opcional)">
      <div class="p-fluid">
        <br>
        <div class="p-field">
          <app-autocomplete
            id="banco"
            label="Banco"
            [(ngModel)]="banco"
            [suggestions]="bancosFiltrados"
            (completeMethod)="filtrarBancos($event)"
            (onDropdownClick)="mostrarTodosBancos()"
            field="nome"
            [required]="false"
            [showValidation]="tentouSalvar"
            emptyMessage="Nenhum banco encontrado"
            placeholder="Digite para buscar um banco"
            [itemTemplate]="bancoTemplate">
          </app-autocomplete>

          <ng-template #bancoTemplate let-banco>
            <div class="flex align-items-center gap-2">
              <span class="font-bold">{{ banco.codigo }}</span>
              <span>{{ banco.nome }}</span>
            </div>
          </ng-template>
        </div>

        <div class="p-field">
          <app-input-text
            id="agencia"
            label="Agência"
            [(ngModel)]="agencia"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-text
            id="conta"
            label="Conta"
            [(ngModel)]="conta"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-text
            id="digitoConta"
            label="Dígito da Conta"
            [(ngModel)]="digitoConta"
            [required]="false"
            [showValidation]="tentouSalvar"
            [maxlength]="2">
          </app-input-text>
        </div>
        <br>
      </div>
    </p-card>

    <!-- Dados PIX -->
    <p-card header="Dados PIX (Opcional)">
      <div class="p-fluid">
        <br>
        <div class="p-field">
          <app-autocomplete
            id="tipoChavePix"
            label="Tipo de Chave PIX"
            [(ngModel)]="tipoChavePixSelecionado"
            [suggestions]="tiposChavePixFiltrados"
            (completeMethod)="filtrarTiposChavePix($event)"
            (onDropdownClick)="mostrarTodosTiposChavePix()"
            field="label"
            [required]="false"
            [showValidation]="tentouSalvar"
            emptyMessage="Nenhum tipo de chave encontrado"
            placeholder="Digite para buscar um tipo de chave">
          </app-autocomplete>
        </div>

        <div class="p-field">
          <app-input-text
            id="chavePix"
            label="Chave PIX"
            [(ngModel)]="chavePix"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>
        <br>
      </div>
    </p-card>

    <!-- Ações -->
    <div class="form-actions">
      <app-custom-button
        label="Cancelar"
        icon="pi pi-times"
        severity="warning"
        (onClick)="cancelar()"
        [disabled]="salvando">
      </app-custom-button>
      <app-custom-button
        label="Limpar"
        icon="pi pi-refresh"
        severity="info"
        [outlined]="true"
        (onClick)="limparTela()"
        [disabled]="salvando">
      </app-custom-button>
      <app-custom-button
        label="Criar Corretor"
        icon="pi pi-save"
        severity="success"
        (onClick)="salvarCorretor()"
        [loading]="salvando">
      </app-custom-button>
    </div>
  </div>
</div>

