<div class="form-container">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <!-- Page Header -->
  <app-page-header
    [title]="usuario?.nome || 'Editar Usuário'"
    subtitle="Altere os dados do usuário"
    icon="pi pi-user-edit">
  </app-page-header>

  <p-progressSpinner *ngIf="carregando"></p-progressSpinner>

  <div *ngIf="!carregando && usuario" class="usuario-form">
    <p-card header="Dados do Usuário">
      <div class="p-fluid">
        <br>
        <div class="p-field">
          <app-input-text
            id="nome"
            label="Nome Completo"
            [(ngModel)]="nome"
            [required]="true"
            [showValidation]="tentouSalvar">
          </app-input-text>
        </div>

        <div class="p-field">
          <app-input-text
            id="email"
            label="E-mail"
            [(ngModel)]="email"
            [required]="true"
            [showValidation]="tentouSalvar"
            [disabled]="editandoProprioUsuario"
            type="email">
          </app-input-text>
          <small *ngIf="editandoProprioUsuario" class="p-text-secondary" style="color: var(--yellow-700);">
            <i class="pi pi-info-circle"></i> Você não pode alterar seu próprio e-mail
          </small>
        </div>

        <div class="p-field">
          <app-input-cpf
            id="cpf"
            label="CPF"
            [(ngModel)]="cpf"
            [required]="true"
            [showValidation]="tentouSalvar"
            [disabled]="true">
          </app-input-cpf>
          <small class="p-text-secondary" style="color: var(--yellow-700);">
            <i class="pi pi-info-circle"></i> CPF cadastrado não pode ser alterado
          </small>
        </div>

        <div class="p-field">
          <app-input-date
            id="dataExpiracao"
            label="Data de Expiração"
            [(ngModel)]="dataExpiracao"
            [required]="false"
            [showValidation]="tentouSalvar">
          </app-input-date>
          <small class="p-text-secondary" style="display: block; margin-top: 0.5rem;">
            <i class="pi pi-info-circle"></i> Deixe vazio para acesso ilimitado
          </small>
        </div>

        <app-autocomplete
          id="perfil"
          label="Perfil"
          [(ngModel)]="perfilSelecionado"
          [suggestions]="perfisFiltrados"
          (completeMethod)="filtrarPerfis($event)"
          (onDropdownClick)="mostrarTodosPerfis()"
          field="nome"
          [required]="true"
          [showValidation]="tentouSalvar"
          [disabled]="editandoProprioUsuario"
          emptyMessage="Nenhum resultado encontrado"
          placeholder="Digite para buscar um perfil"
          [itemTemplate]="perfilTemplate">
        </app-autocomplete>
        <small *ngIf="editandoProprioUsuario" class="p-text-secondary" style="color: var(--yellow-700);">
          <i class="pi pi-info-circle"></i> Você não pode alterar seu próprio perfil
        </small>

        <ng-template #perfilTemplate let-perfil>
          <div>
            <div><strong>{{perfil.nome}}</strong></div>
            <small>{{perfil.descricao}}</small>
          </div>
        </ng-template>

        <div class="p-field-checkbox">
          <p-checkbox
            [(ngModel)]="ativo"
            [binary]="true"
            [disabled]="editandoProprioUsuario"
            inputId="ativo"
            label="Usuário Ativo">
          </p-checkbox>
          <small *ngIf="editandoProprioUsuario" class="p-text-secondary" style="display: block; margin-top: 0.5rem; color: var(--yellow-700);">
            <i class="pi pi-info-circle"></i> Você não pode desativar sua própria conta
          </small>
        </div>

        <div class="p-field-checkbox" style="margin-top: 1rem;">
          <div class="senha-info-box" style="margin-top: 0.25rem;">
            <div class="senha-info-body">
              <i class="pi pi-lock"></i>
              <div class="senha-info-text">
                <strong>Senha gerada automaticamente</strong>
                <p>Ao marcar, uma nova senha será gerada e enviada para o e-mail do usuário.</p>
              </div>
            </div>
            <div class="senha-info-footer">
              <p-checkbox
                [(ngModel)]="resetarSenha"
                [binary]="true"
                inputId="resetarSenha"
                label="Resetar senha">
              </p-checkbox>
            </div>
          </div>
        </div>
        <br>
      </div>
    </p-card>

    <!-- Ações -->
    <div class="form-actions">
      <app-custom-button
        label="Cancelar"
        icon="pi pi-times"
        severity="warning"
        (onClick)="cancelar()">
      </app-custom-button>
      <app-custom-button
        label="Limpar"
        icon="pi pi-refresh"
        severity="info"
        [outlined]="true"
        (onClick)="limparTela()">
      </app-custom-button>
      <app-custom-button
        label="Salvar"
        icon="pi pi-save"
        severity="success"
        [loading]="salvando"
        (onClick)="salvarUsuario()">
      </app-custom-button>
    </div>
  </div>

  <div *ngIf="!carregando && !usuario" class="empty-message">
    <i class="pi pi-exclamation-triangle"></i>
    <h3>Usuário não encontrado</h3>
  </div>
</div>
